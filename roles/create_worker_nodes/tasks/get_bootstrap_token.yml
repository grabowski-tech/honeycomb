---

- name: Get default bootstrap token generated by 'kubeadm init'
  shell: kubeadm token list |sed -n '2p' |awk '{print $1}'
  register: bootstrap_token

- name: Get token ca cert hash
  shell: openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'
  register: cert_hash

- name: Make variable bootstrap_token and cert_hash persistant
  set_fact:
    token: "{{ bootstrap_token.stdout }}"
    hash: "{{ cert_hash.stdout }}"
